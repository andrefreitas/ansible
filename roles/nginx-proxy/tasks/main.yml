- name: SSL Private Key
  copy: content={{ ssl_key }} dest=/srv/ssl/{{domain}}.key
  when: ssl_key is defined

- name: SSL Certficate
  copy: content={{ ssl_crt }} dest=/srv/ssl/{{domain}}.crt
  when: ssl_crt is defined

- name: nginx configuration
  template: src=nginx.conf.j2 dest="/etc/nginx/sites-available/{{domain}}.conf"
  notify:
    - reload nginx

- name: enable website
  file: state=link src=/etc/nginx/sites-available/{{domain}}.conf dest=/etc/nginx/sites-enabled/{{domain}}.conf
  notify:
    - reload nginx
